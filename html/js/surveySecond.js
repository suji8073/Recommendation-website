var recommendation_list_common = [
  [
    "AI 산타토익",
    "[로그인 필요]\n1. 로그인후 AI tutor에게 이름을 말해봅니다. \n2. AI tutor에게 코스를 추천해달라고 요청해봅니다. \n3. AI tutor가 추천한 코스중 하나를 선택하고, 5단계 학습을 해봅니다.",
  ],
  [
    "Super Chinese",
    "[로그인 필요없음] \n1. 홈화면에서 레벨테스트를 클릭하여 5분간 학습합니다.\n2. Level 1에서 학습하고 싶은 메뉴를 고르고 학습을 합니다(기초 중국어/자기소개 중 선택) 3. 성조를 녹음해 봅니다.",
  ],
  [
    "플랭",
    "[로그인 필요] \n1. 오늘의 트레이닝을 클릭합니다.\n2. 짧은 유튜브 영상을 보고 영작하기를 해봅니다.\n3. 영작후, 리스닝-스피킹-감상하기를 순서대로 학습해봅니다.",
  ],
  [
    "오픽업",
    "[로그인 필요] \n1. 홈화면에서 '오늘의 문장' 3문장의 발음 연습을 합니다.(발음연습 버튼을 눌러 한번 듣고- 도전 버튼을 누른 상태에서 녹음을 합니다)\n2. 설문토픽에서 관심있는 주제 두개를 고르고 학습해봅니다. ",
  ],
  [
    "LingoChamp",
    "[로그인 필요]\n1. 동기, 성별, 관심사 등 기본 사항을 선택합니다.\n2. '3일 무료체험' 화면에서 좌측 상단 닫기(x) 클릭합니다.\n3. '나의 영어레벨'을선택하여 간단한 테스트 진행후 레벨을 확인합니다.\n4. 레벨 확인후 좌측 상단 닫기(x)를 클릭하면, '오늘의 학습 내용' 이 보이는 화면에서 아래로 내려가 ' AI 코치 '를 선택하여 학습합니다.",
  ],
  [
    "이지보카",
    "[로그인 필요없음]\n1. 단어장 선택을 누릅니다 -> 공부 목적에 맞게 단어장을 선택합니다.\n2. 'Start'를 눌러 기본학습을 시작합니다. (화면을 터치하면 속도를 조절할 수 있습니다)\n3. 남은 시간동안 '무료 단어장'을 사용하여 학습해봅니다. ",
  ],
  [
    "말해보카",
    "[로그인 필요없음]\n1. 오늘의 학습을 클릭합니다 -> 본인의 학습 목적을 선택합니다.\n2. 20개의 단어 학습을 하고, 나의 영어 어휘력 수준을 파악해봅니다. ",
  ],
  [
    "문정아중국어",
    "[로그인 필요] \n1. 로그인후 가이드봇이 학습 사용법을 알려줍니다 ('다음' 클릭). \n2. 1단계 학습: 에피소드(동영상 1분)를 시청하고 단어 따라해 봅니다.\n3. 2단계 말하기: 중국어 설명과 성조(동영상 1분)에 대한 학습 후 성조를 녹음하며 연습해봅니다.",
  ],
  [
    "듀오링고",
    "[로그인은 선택사항]\n0. 학습하고 싶은 언어를 하나 고릅니다.\n1. 간단한 레벨 테스트 단계와 프로필 생성단계를 거칩니다.\n2. 무료로 할 수 있는 단계 중 하나를 정해 학습합니다.\n3. 남은 시간동안 학습하고 싶은 부분을 학습해봅니다.",
  ],
  [
    "케이크 영어회화",
    "[로그인 필요없음] \n0. 학습하고 싶은 언어를 하나 고릅니다.\n1. 화면 중앙에 보이는 영상 중 학습하고 싶은 영상 하나를 고릅니다.\n2. 영상 아래에 위치한 박스의 우측 상단에 보이는 'Drill'을 사용해 자막없이 동영상을 한번 시청합니다.\n3. 배속버튼을 0.75로 하고, 이번엔 자막을 보며 학습합니다.\n4. 동영상을 2번 시청한 후, '말하기 A레벨에 도전!' 메뉴에서 표현을 따라해봅니다.\n5. 남은 시간 동안 어플을 탐색하여봅니다. ",
  ],
  [
    "YouBot 영어",
    "[로그인 필요] \n1. 동영상을 시청합니다.\n2. INPUT에서 표현학습을 10분정도 해봅니다.\n3. OUTPUT에서 5분정도 학습합니다.",
  ],
  [
    "ELSA Speak",
    "[로그인 없이 가능 - 로그인 없이 체험은 로그인 화면에서 '건너뛰기' 누르기]\n0. 모국어를 한국어로 설정한다음 간단한 설문에 응답합니다.\n1. [제한적인 요금제로 계속이용]을 클릭하여 학습을 시작합니다.\n2. [미니테스트 시작]을 누릅니다.\n3. [발음법 입문]을 클릭하여 학습 해 봅니다.\n4. 남은 시간 동안 어플을 탐색하여봅니다. ",
  ],
  [
    "해커스토익빅플",
    "[로그인 필요]\n1. 첫 화면에서 해커스 진단테스트를 클릭합니다. (로그인 상태에서만 가능)\n2. 앞에 5문제 풀어봅니다. \n3. 답안 제출 후, 취약 유형 확인하고, 시간이 남으면 하나의 취약 유형에 관해서 학습해봅니다.",
  ],
  [
    "멤라이즈(Memrise)",
    "[로그인 필요] \n1. 배우고 싶은 언어를 선택합니다. \n2. 구매를 유도하는 창이 뜨면 [Maybe later]를 선택 합니다.\n3. 첫화면 우측 하단에 [Learn]을 클릭합니다.\n4. [1 - 단어 및 구분] 또는 [2 - 문법 학습] 무료단계 중 수강하고 싶은 강좌를 골라 수강합니다.",
  ],
  [
    "Mondly",
    "[로그인 필요없음] \n1. 배우고 싶은 언어와 레벨을 선택하고 '자습서 시작'을 클릭합니다.\n2. 관심 있는 주제를 선택합니다. \n3. 7일 무료 체험을 건너 뛰고 학습을 시작합니다.\n4. 안녕하세요에 '대화'단계를 선택하고, 학습해봅니다.\n5. 대화단계를 학습하고 메인 메뉴로 나와 '채팅봇 단계'를 눌러서 학습해 봅니다.\n6. 추가로 5분동안 자신이 원하는 메뉴로 들어가 학습을 진행합니다.",
  ],
  [
    "AI Tutor",
    "[로그인 필요]\n1. 로그인 후 'AI튜터's Pick, 결정적 그 표현'에서 자신이 학습하고 싶은 주제를 클릭합니다. \n2. 선택한 주제로 5단계 학습을 해봅니다.\n3. 추가로 자신이 원하는 주제를 선택해 학습을 진행합니다.",
  ],
  [
    "뉴로제타스톤",
    "[로그인 필요]\n1. 학습하고 싶은 언어를 선택합니다.\n2. 학습 목표를 선택합니다.  \n3. 학습 1.1을 진행합니다.\n  \n4. 추가로 자신이 원하는 메뉴에 들어가서 학습을 진행합니다.",
  ],
  [
    "Busuu",
    "[로그인 필요]\n1. 언어 학습 여부, 학습 이유를 클릭합니다.  \n2. 원하는 학습 시간에 '15분'을 입력한 후 계속을 클릭합니다.  \n3. 오른쪽 상단에 있는 '건너뛰기'를 클릭합니다 ('7일 무료 체험 시작' 버튼은 광고입니다).  \n4. '학습을 시작하세요'를 클릭합니다.\n5. 하루에 얻어야 하는 포인트가 채워질 때까지 학습을 진행합니다.",
  ],
];

var type_list = [
  "https://forms.gle/w1NPv7kRsEyu6ZFc7",
  "https://forms.gle/3imYWWhgh5woxXYg6",
  "https://forms.gle/DCFT3juVS358U7CV8",
];

var user_id = sessionStorage.getItem("user_id");
var user_email = sessionStorage.getItem("user_email");

var rec1 = sessionStorage.getItem("rec1");
var rec2 = sessionStorage.getItem("rec2");
var rec3 = sessionStorage.getItem("rec3");
var type = sessionStorage.getItem("type");
var survey1 = sessionStorage.getItem("survey1");
var survey2 = sessionStorage.getItem("survey2");
var survey3 = sessionStorage.getItem("survey3");
var survey_rec = sessionStorage.getItem("survey_rec");

let axiosConfig = {
  Authorization: "Bearer keyTvIqUQEHqc8ufv",
  "Content-Type": "application/json",
};

window.onload = function start() {
  fetch("https://api.airtable.com/v0/appyJbFaZcmTQCGLQ/Table%201/" + user_id, {
    headers: {
      Authorization: "Bearer keyTvIqUQEHqc8ufv",
    },
  })
    .then((response) => {
      if (response.status === 200) {
        return response.json();
      } else {
        throw new Error("Unable ");
      }
    })
    .then((data) => {
      sessionStorage.setItem(
        "rec1",
        data.fields.rec1 === undefined ? 0 : data.fields.rec1
      );
      sessionStorage.setItem(
        "rec2",
        data.fields.rec2 === undefined ? 0 : data.fields.rec2
      );
      sessionStorage.setItem(
        "rec3",
        data.fields.rec3 === undefined ? 0 : data.fields.rec3
      );
      sessionStorage.setItem(
        "type",
        data.fields.type === undefined ? 0 : data.fields.type
      );
      sessionStorage.setItem(
        "survey1",
        data.fields.survey1 === undefined ? 0 : data.fields.survey1
      );
      sessionStorage.setItem(
        "survey2",
        data.fields.survey2 === undefined ? 0 : data.fields.survey2
      );
      sessionStorage.setItem(
        "survey3",
        data.fields.survey3 === undefined ? 0 : data.fields.survey3
      );
      sessionStorage.setItem(
        "survey_rec",
        data.fields.survey_rec === undefined ? 0 : data.fields.survey_rec
      );
    });

  if (survey1 == 1) {
    document.getElementById("icon_1").style.color = "#FBD74A";
  }
  if (survey2 == 1) {
    document.getElementById("icon_2").style.color = "#FBD74A";
  }
  if (survey3 == 1) {
    document.getElementById("icon_3").style.color = "#FBD74A";
  }
  if (survey_rec == 1) {
    document.getElementById("icon_4").style.color = "#FBD74A";
  }
  if (user_email !== null) {
    document.getElementById("login_y_n_main").innerHTML = user_email;
    document.getElementById("login_y_n_main").style.fontSize = "18px";
    document.getElementById("login_").innerHTML = user_email.split("@")[0];
    if (rec1 != 0) {
      document.getElementById("evaluation_1").innerHTML =
        recommendation_list_common[rec1 - 1][0] + " 평가하기";
    }
    if (rec2 != 0) {
      document.getElementById("evaluation_2").innerHTML =
        recommendation_list_common[rec2 - 1][0] + " 평가하기";
    }
    if (rec3 != 0) {
      document.getElementById("evaluation_3").innerHTML =
        recommendation_list_common[rec3 - 1][0] + " 평가하기";
    }
  }
};

function login_check() {
  if (user_email !== null) {
    Swal.fire({
      text: "로그아웃 하시겠습니까?",
      icon: "warning",
      showCancelButton: true,
      cancelButtonColor: "#BDBDBD",
      confirmButtonText: "로그아웃",
      cancelButtonText: "취소",
    }).then((result) => {
      if (result.isConfirmed) {
        Swal.fire({
          text: "로그아웃 되었습니다.",
          icon: "success",
          timer: 1500,
        }).then(function () {
          document.getElementById("login_y_n_main").innerHTML = "Log in";
          document.getElementById("login_y_n_main").style.fontSize = "24px";
          document.getElementById("login_").innerHTML = "Log in";
          sessionStorage.clear();
          location.href = "login.html";
        });
      }
    });
  } else {
    location.href = "login.html";
  }
}

function evaluation_1() {
  if (user_email !== null) {
    if (rec1 != 0) {
      change_sur1();
      window.open("about:blank").location.href =
        "https://forms.gle/d5zPoB2fxiAf7wnd9";
    } else {
      Swal.fire({
        icon: "error",
        text: "추천된 앱이 없습니다.",
        timer: 1500,
      });
    }
  } else {
    Swal.fire({
      icon: "error",
      text: "로그인을 해주세요.",
      timer: 1500,
    });
  }
}
function evaluation_2() {
  if (user_email !== null) {
    if (rec2 != 0) {
      change_sur2();
      window.open("about:blank").location.href =
        "https://forms.gle/d5zPoB2fxiAf7wnd9";
    } else {
      Swal.fire({
        icon: "error",
        text: "추천된 앱이 없습니다.",
        timer: 1500,
      });
    }
  } else {
    Swal.fire({
      icon: "error",
      text: "로그인을 해주세요.",
      timer: 1500,
    });
  }
}

function evaluation_3() {
  if (user_email !== null) {
    if (rec3 != 0) {
      change_sur3();
      window.open("about:blank").location.href =
        "https://forms.gle/d5zPoB2fxiAf7wnd9";
    } else {
      Swal.fire({
        icon: "error",
        text: "추천된 앱이 없습니다.",
        timer: 1500,
      });
    }
  } else {
    Swal.fire({
      icon: "error",
      text: "로그인을 해주세요.",
      timer: 1500,
    });
  }
}

function evaluation_4() {
  if (user_email !== null) {
    var type = sessionStorage.getItem("type");
    if (type > 0) {
      change_sur4();
      window.open("about:blank").location.href = type_list[type - 1];
    } else {
      Swal.fire({
        icon: "error",
        text: "type이 결정되지 않았습니다.",
        timer: 1500,
      });
    }
  } else {
    Swal.fire({
      icon: "error",
      text: "로그인을 해주세요.",
      timer: 1500,
    });
  }
}

function change_sur1() {
  survey1 = sessionStorage.setItem("survey1", "1");
  document.getElementById("icon_1").style.color = "#FBD74A";
  const data = {
    records: [
      {
        id: user_id,
        fields: {
          email: user_email,
          survey1: "1",
        },
      },
    ],
  };

  fetch("https://api.airtable.com/v0/appyJbFaZcmTQCGLQ/Table%201", {
    method: "PATCH",
    body: JSON.stringify(data),
    headers: axiosConfig,
  });
}

function change_sur2() {
  survey2 = sessionStorage.setItem("survey2", "1");
  document.getElementById("icon_2").style.color = "#FBD74A";
  const data = {
    records: [
      {
        id: user_id,
        fields: {
          email: user_email,
          survey2: "1",
        },
      },
    ],
  };

  fetch("https://api.airtable.com/v0/appyJbFaZcmTQCGLQ/Table%201", {
    method: "PATCH",
    body: JSON.stringify(data),
    headers: axiosConfig,
  });
}

function change_sur3() {
  survey3 = sessionStorage.setItem("survey3", "1");
  document.getElementById("icon_3").style.color = "#FBD74A";
  const data = {
    records: [
      {
        id: user_id,
        fields: {
          email: user_email,
          survey3: "1",
        },
      },
    ],
  };

  fetch("https://api.airtable.com/v0/appyJbFaZcmTQCGLQ/Table%201", {
    method: "PATCH",
    body: JSON.stringify(data),
    headers: axiosConfig,
  });
}

function change_sur4() {
  survey_rec = sessionStorage.setItem("survey_rec", "1");
  document.getElementById("icon_4").style.color = "#FBD74A";
  const data = {
    records: [
      {
        id: user_id,
        fields: {
          email: user_email,
          survey_rec: "1",
        },
      },
    ],
  };

  fetch("https://api.airtable.com/v0/appyJbFaZcmTQCGLQ/Table%201", {
    method: "PATCH",
    body: JSON.stringify(data),
    headers: axiosConfig,
  });
}
